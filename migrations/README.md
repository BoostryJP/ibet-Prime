# For developers

## Initial setup

By executing the following command, migration will be performed to the current version.

```bash
$ ./bin/run_migration.sh init
```

## Generate migration script

Once you have changed the DB model, create a migration script.

### Prerequisites
* Complete the initial setup.
* Do not set the environment variable: `DATABASE_SCHEMA`.

### Auto-Generate script

The following steps will automatically generate a migration script.

```bash
$ ./bin/run_migration.sh generate $file_suffix
```
e.g.) ./bin/run_migration.sh generate v1.0.0

### Upgrade

```bash
$ ./bin/run_migration.sh upgrade
```

### Downgrade

To revert to the initial state, execute the following command.

```bash
$ ./bin/run_migration.sh downgrade
```

To revert to the previous version, use `-1`.

```bash
$ ./bin/run_migration.sh downgrade -1
```

## Notice
In the following cases, you will need to manually modify the autogenerated script.

### If column name changed.

* CREATE/DROP script will be generated automatically.
* By executing the auto-generated script, the data in the existing columns will be deleted.

### If column constraint changed.

* The execution of the auto-generated scripts may fail.
* For example, constrains changed Nullable to NotNull, etc